# 终末地抽卡策略模拟器

一个用于模拟《终末地》(Endfield) 抽卡策略的工具，帮助玩家分析不同抽卡策略下的期望收益。

## 功能特性

### 卡池配置
- **创建自定义干员**: 支持4/5/6星干员的创建和管理
- **创建卡池**: 可配置多个卡池，每个卡池可设置：
  - UP干员（50%概率）
  - 保底抽数（definitive draw）
  - 小保底最大抽数（pity draw）
  - 特殊抽奖励（累计抽数达到阈值后获得）
  - 下期卡池抽数奖励
  - UP干员潜能奖励抽数

### 抽卡策略
- **默认策略**: 氪金抽到UP（不可编辑）
- **自定义策略**: 可配置以下参数：
  - 每池最少抽数
  - 跳池阈值（剩余抽数不足时跳过当前卡池）
  - 单抽模式（始终单抽或累计一定抽数后单抽）
  - 氪金模式（抽数不足时额外获得抽数）
  - **获得UP后规则**: 获得UP干员后，根据当前抽数决定是否继续抽取
  - **小保底歪了后规则**: 触发小保底但未获得UP时，根据当前抽数决定是否继续抽取

### 模拟运行
- 支持多卡池同时模拟
- 可配置模拟次数（默认1000次）
- 每个卡池可独立选择使用的策略
- 实时显示模拟进度

### 结果分析
- **汇总统计**:
  - 每池平均总抽数
  - 每池平均氪金抽数
  - 主要干员首抽期望
- **详细数据表格**:
  - 每个干员的平均获取数量
  - 首抽期望（非赠送抽）
  - 特殊抽占比
- **首抽分布直方图**: 可视化展示各干员的首抽抽数分布

### 数据管理
- **导出配置**: 将当前配置压缩为字符串，方便分享
- **导入配置**: 从字符串恢复配置
- **URL状态保存**: 配置自动保存在URL中，刷新页面不丢失

## 安装指南

### Windows

#### 方法一：一键启动（推荐）

1. 下载项目文件到本地
2. 双击运行 `start.bat`
3. 脚本会自动：
   - 检查并安装Python（如果需要）
   - 创建虚拟环境
   - 安装依赖
   - 启动应用

#### 方法二：手动安装

1. **安装 Python 3.10+**

   从 [Python官网](https://www.python.org/downloads/) 下载并安装Python。

   安装时请勾选 "Add Python to PATH"。

2. **打开命令提示符**

   按 `Win + R`，输入 `cmd`，回车。

3. **进入项目目录**
   ```cmd
   cd /d D:\endfield
   ```

4. **创建虚拟环境**
   ```cmd
   python -m venv venv
   ```

5. **激活虚拟环境**
   ```cmd
   venv\Scripts\activate
   ```

6. **安装依赖**
   ```cmd
   pip install -r requirements.txt
   ```

7. **运行应用**
   ```cmd
   streamlit run app.py
   ```

8. **访问应用**

   浏览器会自动打开，或手动访问 http://localhost:8501

### Linux / macOS

1. **安装 Python 3.10+**

   Ubuntu/Debian:
   ```bash
   sudo apt update
   sudo apt install python3 python3-pip python3-venv
   ```

   macOS (使用 Homebrew):
   ```bash
   brew install python@3.10
   ```

2. **进入项目目录**
   ```bash
   cd /path/to/endfield
   ```

3. **创建虚拟环境**
   ```bash
   python3 -m venv venv
   ```

4. **激活虚拟环境**
   ```bash
   source venv/bin/activate
   ```

5. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

6. **运行应用**
   ```bash
   streamlit run app.py
   ```

7. **访问应用**

   浏览器会自动打开，或手动访问 http://localhost:8501

## 使用说明

### 1. 配置卡池

1. 在左侧边栏创建干员（如需要）
2. 创建或编辑卡池
3. 为卡池添加干员并设置UP干员
4. 配置卡池的保底规则和奖励

### 2. 配置策略

1. 默认策略"氪金抽到UP"适用于追求必得UP的玩家
2. 点击"创建策略"创建自定义策略
3. 配置策略参数：
   - **获得UP后规则**: 例如设置阈值80、目标80，表示在80抽前获得UP则继续抽到80抽
   - **小保底歪了后规则**: 例如设置阈值70、目标120，表示在70抽前歪了则继续抽到大保底

### 3. 运行模拟

1. 在"运行模拟"区域选择要参与模拟的卡池
2. 为每个卡池选择使用的策略
3. 设置模拟次数（次数越多结果越准确，但耗时越长）
4. 点击"运行模拟"开始

### 4. 查看结果

- 顶部显示汇总统计（平均抽数、主要干员首抽期望）
- 表格显示每个干员的详细数据
- 直方图展示首抽分布

## 依赖项

- Python 3.10+
- streamlit
- pandas
- pydantic

## 常见问题

**Q: 模拟速度很慢？**

A: 减少模拟次数（如改为500次），或关闭其他占用CPU的程序。

**Q: 结果和预期不符？**

A: 检查卡池配置是否正确，特别是保底抽数和小保底抽数的设置。

**Q: 如何分享我的配置？**

A: 点击"导出配置"复制配置字符串，分享给他人后使用"导入配置"即可恢复。

## 许可证

MIT License
